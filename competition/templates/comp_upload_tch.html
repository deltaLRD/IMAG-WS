{% extends 'base_tch.html' %}
{% block center %}
    <form id="formid" method="POST" enctype="multipart/form-data">
        <div class="form-group">
            <label for="exampleInputEmail1">竞赛名</label>
            <input type="text" class="form-control" id="exampleInputEmail1" placeholder="竞赛" name="name" required>
        </div>
        <div class="form-group">
            <label for="exampleInputEmail1">指导教师</label>
            <input type="text" class="form-control" id="exampleInputEmail1" placeholder="用英文逗号将姓名隔开" name="teachers">
        </div>
        <div class="form-group">
            <label for="exampleInputPassword1">参与人员</label>
            <input type="text" class="form-control" placeholder="用英文逗号将姓名隔开" name="participant">
        </div>
        <div class="form-group">
            <label for="exampleInputPassword1">获得奖项</label>
            <input type="text" class="form-control" placeholder="获得奖项或排名" name="ranking" required>
        </div>
        <div class="form-group">
            <label for="exampleInputFile">是否添加</label>
            <label class="checkbox-inline">
                <input type="checkbox" id="inlineCheckbox1" value="1" name="adds">
            </label>
        </div>
        <button type="button" class="btn btn-default" onclick="commit_data()">上传</button>
    </form>
    <script>
    function commit_data(){
        var data = new FormData($("#formid")[0]);
        data.append('account',{{ account_url.account|tojson }})
        console.log(data)
        $.ajax({
                type: 'POST',
                url: "/competition/comp_upload_back",
                data: data,
                dataType: 'json',
                cache: false,//上传文件无需缓存
                processData: false,//用于对data参数进行序列化处理 这里必须false
                contentType: false, //必须
                success: function (data) {
                    console.log(data)
                    if (data['error'] === 1) {
                        layer.msg(data['msg'], {
                            icon: 2,
                            time: 1000,
                            offset: 't',
                        });
                    } else {
                        layer.msg(data['msg'], {
                            icon: 1,
                            time: 1000,
                            offset: 't',
                        })
                        tiao(data['url'])
                    }
                }
        })
    }
    async function tiao(url){
                setTimeout(() => {
                    window.location.href=url
                }, 1000);
        }
    </script>
{% endblock %}